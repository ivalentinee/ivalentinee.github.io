<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
<head>
<title>Emacs и блог</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Emacs и блог"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2014-05-24"/>
<meta name="author" content="Emperor"/>
<meta name="description" content="Emacs как средство публикации записей"/>
<meta name="keywords" content="org-mode org emacs blogging"/>

<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/post-style.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/post-layout.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/hide-copyright.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/menu.css" />
<script async="true" src="/javascript/run_prettify.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/google-code-prettify/desert-theme.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/post-style.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/post-layout.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/menu.css" />
<script async="true" src="/javascript/run_prettify.js"></script>
<link rel="stylesheet" type="text/css" href="/stylesheets/google-code-prettify/desert-theme.css" />
<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css">
<link rel="stylesheet" type="text/css" href="stylesheets/sitemap-style.css" />
<link rel="stylesheet" type="text/css" href="stylesheets/sitemap-layout.css" />

</head>
<body>

<div id="preamble">
<div class="header"><h1>Emacs и блог</h1><h2>Emacs как средство публикации записей</h2></div>
</div>

<div class="content" id="content">

<div id="menu">
  <div class="pure-menu pure-menu-open">
    <a class="pure-menu-heading" href="/">Блог</a>
    <ul>
      <li><a href="/index.html">Записи</a></li>
      <li><a href="http://northempire.tk/">Домой</a></li>
    </ul>
  </div>
</div>



<div id="outline-container-1" class="outline-1">
<h1 id="sec-1"><span class="section-number-1">1</span> Предисловие</h1>
<div class="outline-text-1" id="text-1">

<p>Итак, это наконец-то случилось. Допилил экспорт из Emacs в html с нормальным <a href="../index.html">sitemap'ом</a>. Теперь буду как все социокуртизанки постить про всё подряд. Ага.
</p></div>

</div>

<div id="outline-container-2" class="outline-1">
<h1 id="sec-2"><span class="section-number-1">2</span> Что использовалось</h1>
<div class="outline-text-1" id="text-2">

<p>Для публикации записей использован замечательный <a href="http://www.emacswiki.org/emacs/OrgMode">org-mode</a>.<br/>
Для запиливания были использованы <a href="http://orgmode.org/">сайт org-mode</a> и <a href="http://stackoverflow.com/">stackoverflow</a>.
</p></div>

</div>

<div id="outline-container-3" class="outline-1">
<h1 id="sec-3"><span class="section-number-1">3</span> Как сделано</h1>
<div class="outline-text-1" id="text-3">

<p>Итак, начнём.
</p>
</div>

<div id="outline-container-3-1" class="outline-2">
<h2 id="sec-3-1"><span class="section-number-2">3.1</span> Базовые штуки</h2>
<div class="outline-text-2" id="text-3-1">


</div>

<div id="outline-container-3-1-1" class="outline-3">
<h3 id="sec-3-1-1"><span class="section-number-3">3.1.1</span> projects.el</h3>
<div class="outline-text-3" id="text-3-1-1">

<p>Именно <a href="https://github.com/vemperor/Blog-Source/blob/master/projects.el">в этом файле</a> находится основная конфигурация проекта.<br/>
Кроме материалов мануала ничего не использовалось, поэтому комментировать нечего.<br/>
Немного фарш, конечно, и raw html в конфиге. Но с этим я пока возиться не стал. Может быть когда-нибудь сделаю нормально.
</p></div>

</div>

<div id="outline-container-3-1-2" class="outline-3">
<h3 id="sec-3-1-2"><span class="section-number-3">3.1.2</span> customized-org-html.el</h3>
<div class="outline-text-3" id="text-3-1-2">


</div>

<div id="outline-container-3-1-2-1" class="outline-4">
<h4 id="sec-3-1-2-1"><span class="section-number-4">3.1.2.1</span> org-export-html</h4>
<div class="outline-text-4" id="text-3-1-2-1">

<p>Ввиду того, что оригинальный org-export-html делает пару вещей не так, пришлось <a href="https://github.com/vemperor/emacs_config/blob/20999812763e86b95dfe84c3d57bbe8c1f28c416/.emacs.d/global/customized-org-html.el#L587">сделать свою функцию экспорта</a> (копипаста оригинала, C-s и C-S-%). Также пришлось сделать <a href="https://github.com/vemperor/emacs_config/blob/20999812763e86b95dfe84c3d57bbe8c1f28c416/.emacs.d/global/customized-org-html.el#L45">собственную функцию публикации</a>.
</p></div>

</div>

<div id="outline-container-3-1-2-2" class="outline-4">
<h4 id="sec-3-1-2-2"><span class="section-number-4">3.1.2.2</span> Ссылки на файлы</h4>
<div class="outline-text-4" id="text-3-1-2-2">

<p>Org-mode умеет красиво делать ссылки на файлы (в моём случае &mdash; картинки). Но не очень красиво их заворачивает при экспорте. Слава <a href="http://stackoverflow.com/">stackoverflow</a>, я нашёл <a href="http://stackoverflow.com/questions/14684263/how-to-org-mode-image-absolute-path-of-export-html">решение</a>. Приведу здесь код
</p>


<pre name="code" class="prettyprint lang-lisp">
(defun org-custom-link-img-follow (path)
  (org-open-file-with-emacs
   (format "../images/%s" path)))

(defun org-custom-link-img-export (path desc format)
  (cond
   ((eq format 'html)
    (format "&lt;img src=\"/images/%s\" alt=\"%s\"/&gt;" path desc))))

(org-add-link-type "img" 'org-custom-link-img-follow 'org-custom-link-img-export)
</pre>

<p>
<b>UPD</b>
Также добавил тип ссылок с превью img-t. И сейчас же его использую, чтобы потом возвращаться к тексту поста.<br/>
Автор фотографии &mdash; <a href="http://gongled.ru/">Глеб Гончаров</a>.
</p>
<p>
<a title="Тестовое изображение" href="/images/test.jpg"><img src="/images/thumbnails/test.jpg"></a>
</p>
</div>
</div>
</div>

</div>

<div id="outline-container-3-2" class="outline-2">
<h2 id="sec-3-2"><span class="section-number-2">3.2</span> Разные плюшки</h2>
<div class="outline-text-2" id="text-3-2">

<p>С основной частью мы разобрались, теперь про остальное.
</p>
</div>

<div id="outline-container-3-2-1" class="outline-3">
<h3 id="sec-3-2-1"><span class="section-number-3">3.2.1</span> Стили</h3>
<div class="outline-text-3" id="text-3-2-1">

<p>Для внешнего вида решил пользовать <a href="http://purecss.io/">pure css</a>. Приятный и простой css-framework, показался мне симпатичным.<br/>
Подключается всё это дело через шаблоны (org-template). Вот код шаблона
</p>


<pre name="code" class="prettyprint lang-lisp">
#+AUTHOR:    Emperor
#+EMAIL:     valentine.emperor@gmail.com
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css"&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="/stylesheets/post-style.css" /&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="/stylesheets/post-layout.css" /&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="/stylesheets/menu.css" /&gt;

#+STYLE: &lt;script async="true" src="/javascript/run_prettify.js"&gt;&lt;/script&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="/stylesheets/google-code-prettify/desert-theme.css" /&gt;

#+OPTIONS: toc:t
#+LANGUAGE: ru
</pre>


</div>

<div id="outline-container-3-2-1-1" class="outline-4">
<h4 id="sec-3-2-1-1"><span class="section-number-4">3.2.1.1</span> Подсветка кода</h4>
<div class="outline-text-4" id="text-3-2-1-1">

<p>Для подсветки кода используется <a href="http://code.google.com/p/google-code-prettify/">google-code-prettify</a>. Как видно выше, в шаблоне подключаются соответствующие .js и .css.<br/>
Также перепилена <a href="https://github.com/vemperor/emacs_config/blob/20999812763e86b95dfe84c3d57bbe8c1f28c416/.emacs.d/global/customized-org-html.el#L147">функция экспорта кода</a>.
</p></div>
</div>

</div>

<div id="outline-container-3-2-2" class="outline-3">
<h3 id="sec-3-2-2"><span class="section-number-3">3.2.2</span> Меню</h3>
<div class="outline-text-3" id="text-3-2-2">

<p>Для меню у меня отдельный кусок html-кода, который нагло украден со <a href="http://purecss.io/layouts/side-menu/">страницы соответствующего layout'а pure css</a>.<br/>
Подключается отдельным org-файлом. К сожалению, приходится подключать вручную в каждом файле поста. Щито поделать, десу.
</p></div>

</div>

<div id="outline-container-3-2-3" class="outline-3">
<h3 id="sec-3-2-3"><span class="section-number-3">3.2.3</span> Карта сайта (aka index.html)</h3>
<div class="outline-text-3" id="text-3-2-3">

<p>Тут основные настройки прописаны в <a href="#sec-3-1-1">projects.el</a>.<br/>
Стоит только отметить, что для sitemap'а отдельный шаблон. Ради этого была препилена <a href="https://github.com/vemperor/emacs_config/blob/20999812763e86b95dfe84c3d57bbe8c1f28c416/.emacs.d/global/customized-org-html.el#L53">функция генерации sitemap'а</a>. Приведу текст шаблона.
</p>


<pre name="code" class="prettyprint lang-lisp">
#+AUTHOR:    Emperor
#+EMAIL:     valentine.emperor@gmail.com
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/pure/0.4.2/pure-min.css"&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="stylesheets/sitemap-style.css" /&gt;
#+STYLE: &lt;link rel="stylesheet" type="text/css" href="stylesheets/sitemap-layout.css" /&gt;

#+HTML_CONTAINER: div

#+OPTIONS: toc:nil
#+LANGUAGE: ru
</pre>

<p>
Очевидно, что отличается он только layout'ом.
</p></div>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-1">
<h1 id="sec-4"><span class="section-number-1">4</span> Что дальше</h1>
<div class="outline-text-1" id="text-4">

<p><del>Теперь надо прикрутить комменты из google+</del> <b>добавил disqus</b>, angular / jquery / что_ещё_там_напридумывали_для_жабоскрапта для некоторой интерактивности, допилить стили. В первую очередь надо прикрутить сворачиваемость кода и содержания.
</p>


  <div id="disqus_thread"></div>
  <script type="text/javascript">
   /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
   var disqus_shortname = 'northempire'; // required: replace example with your forum shortname
   
   /* * * DON'T EDIT BELOW THIS LINE * * */
   (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
</div>
</div>

<div id="postamble">
<div class="postamble-content">
  <div class="pure-g-r">

    <div class="pure-u-1-2">
      <ul class="postamble-copyright">
        <li>Built with <a href="http://purecss.io/">Pure CSS</a></li>
        <li>Created with <a href="http://www.gnu.org/software/emacs/">Emacs</a> and <a href="http://orgmode.org/">Org-Mode</a></li>
        <li><span style="-webkit-transform: rotate(180deg); -moz-transform: rotate(180deg); -o-transform: rotate(180deg); -khtml-transform: rotate(180deg); -ms-transform: rotate(180deg); transform: rotate(180deg); display: inline-block;">
	&copy;
</span> Валентин Ионов, 2014</li>
      </ul>
    </div>

    <div class="pure-u-1-2">
      <ul class="postamble-links">
        <li><a href="https://github.com/vemperor">Github</a></li>
        <li><a href="https://plus.google.com/u/0/111577518760980284675">Google+</a></li>
        <li><a href="https://vk.com/v_emperor">VK</a></li>
      </ul>
    </div>

  </div>
</div>
</div>
</body>
</html>
