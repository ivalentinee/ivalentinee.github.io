<!DOCTYPE html>
<html lang="ru"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Эксплуатация прежде всего | ivalentinee</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Эксплуатация прежде всего" />
<meta property="og:locale" content="ru" />
<meta name="description" content="Введение Этот пост написан в основном для тех беспечных разработчиков, которые пишут код без учёта эксплуатации. Что такое эксплуатация? Вики определяет эксплуатацию как “использование чего-либо”. Как используются программы? Их устанавливают, конфигурируют, после чего убеждаются в корректности работы в соответствии с инструкцией. Чтобы сделать программу эксплуатируемой необходимо предоставить документацию для всех этих процессов. По правде говоря, проекты (а иногда даже продукты) редко сопровождаются хотя бы какой-то документацией, не говоря уже про документацию по эксплуатации. Подход “Это как-то работает”, “просто перезапусти”, вот это всё. Поэтому я попытаюсь объяснить, как сделать веб-сервисы эксплуатируемыми. Есть один достаточно известный ресурс по этой теме, который более обширный и формальный, чем моя статья. Стандартизируй! Под этим я имею ввиду две вещи. Сделай стандарт документации по эксплуатации Во-первых, спроси своих коллег из отдела эксплуатации (админов). Особенно если уже есть какие-то сервисы в эксплуатации. Что они используют? Какой информации им не хватает? Во-вторых, изучи свои проекты (и уже в эксплуатации и в ранней разработке). Подумай обо всех местах, которые могут быть сконфигурированы, о ситуациях, которые могут случиться. Думаешь, твою систему так легко понять? Я разочарую: совсем нет. После сбора общей информации нужно написать шаблон документации по эксплуатации и всем его показать, обсудить, затем улучшить. При этом нельзя относиться к получившемуся шаблону как к чему-то неизменному. После всех инцедентов (особенно пост-мортемов) необходимо подумать, не нужно ли добавить (или убрать) что-то в шаблон, чтобы, обладая документацией, команда эксплуатации смогла сама восстановить работу сервиса. Сделай процесс документирования обязательным для всех разработчиков С этим немного сложнее. Если ты — тимлид или старший разработчик, то используй свою власть чтобы сделать документирование эксплуатации обязательным. Если ты рядовой сотрудник — используй техники убеждения социальную инженерию, меритократические наклонности, своего начальника, свою репутацию, веди себя как полная скотина, но заставь всех писать документацию по эксплуатации. Просто поверь мне, это спасёт тебя лично от бессонных ночей (особенно если ты — тимлид или менеджер). Сделай свою систему эксплуатируемой Это тоже непросто. Всё вот это добро из 12-factor — это сюда. ENV-конфиги проекта Это то, что я видел очень много раз. И каждый раз я старался от этого избавиться. Если в папке config есть что-то кроме production- и test-конфигов — всё плохо. Просто представь: в час ночи сервер БД падает без шансов на восстановление, но у админов есть реплика, на которую можно переключиться очень быстро (в пределах SLA) просто поменяв IP-адрес (или доменное имя) БД в приложении. Но с хардкодом в production-конфиге это делается только через изменение кода и редеплой приложения. И вот она, бессонная ночь. И не одна. Поэтому, чтобы сделать систему конфигурироемой “находу”, нужен либо config-provider, либо просто получение значений из ENV-переменных (со значениями по-умолчанию). Это уже добавит достаточно много сна в беспокойную жизнь разработчика. И конечно, конфигурацию (ENV-переменные или config-provider’ы) очень даже стоит документировать. Поверь мне. Добавь проверки запущенности (readiness) и работоспособности (liveness) Или, как некоторые их называют, хелсчеки. Я не про кубернетисы. Зачем? Админам желательно знать, когда приложение уже запустилось (readiness) и когда оно упало (liveness). Обычно веб-приложениям хватает ответа 200 OK на запрос / для обеих проверок. И затем опиши это всё в документации. Сделай кастомный endpoint для мониторинга Фишка в том, что скорее всего у админов уже есть какой-то инструмент мониторинга. Нет ничего плохого в том, чтобы помочь им. Есть подозрения, что какая-то ошибка может проявиться? Отправляй их в мониторинг. Есть внешние системы? Проверяй к ним доступ. Мы (на тех проектах, которые я разрабатывал) использовали /healthcheck с примерно следующим содержимым: db ok smtp ok rabbitmq ok И опиши это в документации по эксплуатации. Опиши все сервисы Используешь СУБД? Веб-сервер? Отправляешь email’ы? Опиши! Для каждого описываемого сервиса нужно описать: Откуда брать. Сборка кода? Docker? RPM-пакеты? Как запустить: команды, аргументы, флаги, вот это всё. Что сделать при первом старте. Например, импортировать какие-то данные “по-умолчанию” (возможно специальной командой). Зависимости. Не думаю, что есть смысл запускать сервер приложения до запуска СУБД. Масштабируемость. Веб-сервер достаточно легко (авто)масштабируется. А вот с масштабированием СУБД обычно всё не так хорошо. Требуемые ресурсы для работы. Память, процессор, диски, сокеты, inode’ы. Бэкапы. Что, как и когда нужно бэкапить и как это нужно восстанавливать. Зачем нужен этот сервис. Что именно он делает. Это поможет понять, можно ли перезапустить этот отдельный сервис или всё куда сложнее. При этом нужно помнить, что то, что ты обычно называешь “приложением” на самом деле тоже является сервисом. Puma с рельсами на борту — HTTP-сервер. Cowboy с фениксом на борту — тоже HTTP-сервер. Java со спрингом — это очень плохая идея нужно от такого избавляться год назад. Опиши сеть Какие сервисы должны смотреть в мир? Какие сервисы должны смотреть друг в друга? Всё это — очень важная информация о том говнокоде, над которым ты сидел месяцами (или даже годами). Ручки Есть скрипт полной очистки? Кнопка пересборки кеша? Нет — сделай. И опиши. Вместо заключения Этим, на самом деле, список не ограничивается. Не надо “просто писать код”. Нужно делать эксплуатируемые сервисы." />
<meta property="og:description" content="Введение Этот пост написан в основном для тех беспечных разработчиков, которые пишут код без учёта эксплуатации. Что такое эксплуатация? Вики определяет эксплуатацию как “использование чего-либо”. Как используются программы? Их устанавливают, конфигурируют, после чего убеждаются в корректности работы в соответствии с инструкцией. Чтобы сделать программу эксплуатируемой необходимо предоставить документацию для всех этих процессов. По правде говоря, проекты (а иногда даже продукты) редко сопровождаются хотя бы какой-то документацией, не говоря уже про документацию по эксплуатации. Подход “Это как-то работает”, “просто перезапусти”, вот это всё. Поэтому я попытаюсь объяснить, как сделать веб-сервисы эксплуатируемыми. Есть один достаточно известный ресурс по этой теме, который более обширный и формальный, чем моя статья. Стандартизируй! Под этим я имею ввиду две вещи. Сделай стандарт документации по эксплуатации Во-первых, спроси своих коллег из отдела эксплуатации (админов). Особенно если уже есть какие-то сервисы в эксплуатации. Что они используют? Какой информации им не хватает? Во-вторых, изучи свои проекты (и уже в эксплуатации и в ранней разработке). Подумай обо всех местах, которые могут быть сконфигурированы, о ситуациях, которые могут случиться. Думаешь, твою систему так легко понять? Я разочарую: совсем нет. После сбора общей информации нужно написать шаблон документации по эксплуатации и всем его показать, обсудить, затем улучшить. При этом нельзя относиться к получившемуся шаблону как к чему-то неизменному. После всех инцедентов (особенно пост-мортемов) необходимо подумать, не нужно ли добавить (или убрать) что-то в шаблон, чтобы, обладая документацией, команда эксплуатации смогла сама восстановить работу сервиса. Сделай процесс документирования обязательным для всех разработчиков С этим немного сложнее. Если ты — тимлид или старший разработчик, то используй свою власть чтобы сделать документирование эксплуатации обязательным. Если ты рядовой сотрудник — используй техники убеждения социальную инженерию, меритократические наклонности, своего начальника, свою репутацию, веди себя как полная скотина, но заставь всех писать документацию по эксплуатации. Просто поверь мне, это спасёт тебя лично от бессонных ночей (особенно если ты — тимлид или менеджер). Сделай свою систему эксплуатируемой Это тоже непросто. Всё вот это добро из 12-factor — это сюда. ENV-конфиги проекта Это то, что я видел очень много раз. И каждый раз я старался от этого избавиться. Если в папке config есть что-то кроме production- и test-конфигов — всё плохо. Просто представь: в час ночи сервер БД падает без шансов на восстановление, но у админов есть реплика, на которую можно переключиться очень быстро (в пределах SLA) просто поменяв IP-адрес (или доменное имя) БД в приложении. Но с хардкодом в production-конфиге это делается только через изменение кода и редеплой приложения. И вот она, бессонная ночь. И не одна. Поэтому, чтобы сделать систему конфигурироемой “находу”, нужен либо config-provider, либо просто получение значений из ENV-переменных (со значениями по-умолчанию). Это уже добавит достаточно много сна в беспокойную жизнь разработчика. И конечно, конфигурацию (ENV-переменные или config-provider’ы) очень даже стоит документировать. Поверь мне. Добавь проверки запущенности (readiness) и работоспособности (liveness) Или, как некоторые их называют, хелсчеки. Я не про кубернетисы. Зачем? Админам желательно знать, когда приложение уже запустилось (readiness) и когда оно упало (liveness). Обычно веб-приложениям хватает ответа 200 OK на запрос / для обеих проверок. И затем опиши это всё в документации. Сделай кастомный endpoint для мониторинга Фишка в том, что скорее всего у админов уже есть какой-то инструмент мониторинга. Нет ничего плохого в том, чтобы помочь им. Есть подозрения, что какая-то ошибка может проявиться? Отправляй их в мониторинг. Есть внешние системы? Проверяй к ним доступ. Мы (на тех проектах, которые я разрабатывал) использовали /healthcheck с примерно следующим содержимым: db ok smtp ok rabbitmq ok И опиши это в документации по эксплуатации. Опиши все сервисы Используешь СУБД? Веб-сервер? Отправляешь email’ы? Опиши! Для каждого описываемого сервиса нужно описать: Откуда брать. Сборка кода? Docker? RPM-пакеты? Как запустить: команды, аргументы, флаги, вот это всё. Что сделать при первом старте. Например, импортировать какие-то данные “по-умолчанию” (возможно специальной командой). Зависимости. Не думаю, что есть смысл запускать сервер приложения до запуска СУБД. Масштабируемость. Веб-сервер достаточно легко (авто)масштабируется. А вот с масштабированием СУБД обычно всё не так хорошо. Требуемые ресурсы для работы. Память, процессор, диски, сокеты, inode’ы. Бэкапы. Что, как и когда нужно бэкапить и как это нужно восстанавливать. Зачем нужен этот сервис. Что именно он делает. Это поможет понять, можно ли перезапустить этот отдельный сервис или всё куда сложнее. При этом нужно помнить, что то, что ты обычно называешь “приложением” на самом деле тоже является сервисом. Puma с рельсами на борту — HTTP-сервер. Cowboy с фениксом на борту — тоже HTTP-сервер. Java со спрингом — это очень плохая идея нужно от такого избавляться год назад. Опиши сеть Какие сервисы должны смотреть в мир? Какие сервисы должны смотреть друг в друга? Всё это — очень важная информация о том говнокоде, над которым ты сидел месяцами (или даже годами). Ручки Есть скрипт полной очистки? Кнопка пересборки кеша? Нет — сделай. И опиши. Вместо заключения Этим, на самом деле, список не ограничивается. Не надо “просто писать код”. Нужно делать эксплуатируемые сервисы." />
<link rel="canonical" href="https://ivalentinee.github.io/ru/programming/2020/11/02/exploitation-first.html" />
<meta property="og:url" content="https://ivalentinee.github.io/ru/programming/2020/11/02/exploitation-first.html" />
<meta property="og:site_name" content="ivalentinee" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-11-02T00:00:00+00:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://ivalentinee.github.io/ru/programming/2020/11/02/exploitation-first.html"},"description":"Введение Этот пост написан в основном для тех беспечных разработчиков, которые пишут код без учёта эксплуатации. Что такое эксплуатация? Вики определяет эксплуатацию как “использование чего-либо”. Как используются программы? Их устанавливают, конфигурируют, после чего убеждаются в корректности работы в соответствии с инструкцией. Чтобы сделать программу эксплуатируемой необходимо предоставить документацию для всех этих процессов. По правде говоря, проекты (а иногда даже продукты) редко сопровождаются хотя бы какой-то документацией, не говоря уже про документацию по эксплуатации. Подход “Это как-то работает”, “просто перезапусти”, вот это всё. Поэтому я попытаюсь объяснить, как сделать веб-сервисы эксплуатируемыми. Есть один достаточно известный ресурс по этой теме, который более обширный и формальный, чем моя статья. Стандартизируй! Под этим я имею ввиду две вещи. Сделай стандарт документации по эксплуатации Во-первых, спроси своих коллег из отдела эксплуатации (админов). Особенно если уже есть какие-то сервисы в эксплуатации. Что они используют? Какой информации им не хватает? Во-вторых, изучи свои проекты (и уже в эксплуатации и в ранней разработке). Подумай обо всех местах, которые могут быть сконфигурированы, о ситуациях, которые могут случиться. Думаешь, твою систему так легко понять? Я разочарую: совсем нет. После сбора общей информации нужно написать шаблон документации по эксплуатации и всем его показать, обсудить, затем улучшить. При этом нельзя относиться к получившемуся шаблону как к чему-то неизменному. После всех инцедентов (особенно пост-мортемов) необходимо подумать, не нужно ли добавить (или убрать) что-то в шаблон, чтобы, обладая документацией, команда эксплуатации смогла сама восстановить работу сервиса. Сделай процесс документирования обязательным для всех разработчиков С этим немного сложнее. Если ты — тимлид или старший разработчик, то используй свою власть чтобы сделать документирование эксплуатации обязательным. Если ты рядовой сотрудник — используй техники убеждения социальную инженерию, меритократические наклонности, своего начальника, свою репутацию, веди себя как полная скотина, но заставь всех писать документацию по эксплуатации. Просто поверь мне, это спасёт тебя лично от бессонных ночей (особенно если ты — тимлид или менеджер). Сделай свою систему эксплуатируемой Это тоже непросто. Всё вот это добро из 12-factor — это сюда. ENV-конфиги проекта Это то, что я видел очень много раз. И каждый раз я старался от этого избавиться. Если в папке config есть что-то кроме production- и test-конфигов — всё плохо. Просто представь: в час ночи сервер БД падает без шансов на восстановление, но у админов есть реплика, на которую можно переключиться очень быстро (в пределах SLA) просто поменяв IP-адрес (или доменное имя) БД в приложении. Но с хардкодом в production-конфиге это делается только через изменение кода и редеплой приложения. И вот она, бессонная ночь. И не одна. Поэтому, чтобы сделать систему конфигурироемой “находу”, нужен либо config-provider, либо просто получение значений из ENV-переменных (со значениями по-умолчанию). Это уже добавит достаточно много сна в беспокойную жизнь разработчика. И конечно, конфигурацию (ENV-переменные или config-provider’ы) очень даже стоит документировать. Поверь мне. Добавь проверки запущенности (readiness) и работоспособности (liveness) Или, как некоторые их называют, хелсчеки. Я не про кубернетисы. Зачем? Админам желательно знать, когда приложение уже запустилось (readiness) и когда оно упало (liveness). Обычно веб-приложениям хватает ответа 200 OK на запрос / для обеих проверок. И затем опиши это всё в документации. Сделай кастомный endpoint для мониторинга Фишка в том, что скорее всего у админов уже есть какой-то инструмент мониторинга. Нет ничего плохого в том, чтобы помочь им. Есть подозрения, что какая-то ошибка может проявиться? Отправляй их в мониторинг. Есть внешние системы? Проверяй к ним доступ. Мы (на тех проектах, которые я разрабатывал) использовали /healthcheck с примерно следующим содержимым: db ok smtp ok rabbitmq ok И опиши это в документации по эксплуатации. Опиши все сервисы Используешь СУБД? Веб-сервер? Отправляешь email’ы? Опиши! Для каждого описываемого сервиса нужно описать: Откуда брать. Сборка кода? Docker? RPM-пакеты? Как запустить: команды, аргументы, флаги, вот это всё. Что сделать при первом старте. Например, импортировать какие-то данные “по-умолчанию” (возможно специальной командой). Зависимости. Не думаю, что есть смысл запускать сервер приложения до запуска СУБД. Масштабируемость. Веб-сервер достаточно легко (авто)масштабируется. А вот с масштабированием СУБД обычно всё не так хорошо. Требуемые ресурсы для работы. Память, процессор, диски, сокеты, inode’ы. Бэкапы. Что, как и когда нужно бэкапить и как это нужно восстанавливать. Зачем нужен этот сервис. Что именно он делает. Это поможет понять, можно ли перезапустить этот отдельный сервис или всё куда сложнее. При этом нужно помнить, что то, что ты обычно называешь “приложением” на самом деле тоже является сервисом. Puma с рельсами на борту — HTTP-сервер. Cowboy с фениксом на борту — тоже HTTP-сервер. Java со спрингом — это очень плохая идея нужно от такого избавляться год назад. Опиши сеть Какие сервисы должны смотреть в мир? Какие сервисы должны смотреть друг в друга? Всё это — очень важная информация о том говнокоде, над которым ты сидел месяцами (или даже годами). Ручки Есть скрипт полной очистки? Кнопка пересборки кеша? Нет — сделай. И опиши. Вместо заключения Этим, на самом деле, список не ограничивается. Не надо “просто писать код”. Нужно делать эксплуатируемые сервисы.","@type":"BlogPosting","url":"https://ivalentinee.github.io/ru/programming/2020/11/02/exploitation-first.html","headline":"Эксплуатация прежде всего","dateModified":"2020-11-02T00:00:00+00:00","datePublished":"2020-11-02T00:00:00+00:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://ivalentinee.github.io/feed.xml" title="ivalentinee" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/ru/">ivalentinee</a>

    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
              
            
          
            
            
              
                <a class="page-link" href="/ru/about/">Обо мне</a>
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
          
            
            
          
            
            
              
            
          
            
            
          
            
            
              
            
          
            
            
              
            
          
            
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
              
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Эксплуатация прежде всего</h1>
    <p class="post-meta">
      <time datetime="2020-11-02T00:00:00+00:00" itemprop="datePublished">
        
        Nov 2, 2020
      </time>
      </p>
  </header>

          <div class="language-selector">
          <a href="/en/programming/2019/09/14/exploitation-first.html" class="language-selector-link">English</a><span class="language-selector-separator">|</span><span class="language-selector-link">Русский</span>
        </div>


  <div class="post-content" itemprop="articleBody">
    <h2 id="введение">Введение</h2>

<p>Этот пост написан в основном для тех <a href="https://youtu.be/izGwDsrQ1eQ">беспечных</a> разработчиков, которые пишут код без учёта эксплуатации.</p>

<p>Что такое <strong>эксплуатация</strong>? <a href="https://ru.wiktionary.org/wiki/%D1%8D%D0%BA%D1%81%D0%BF%D0%BB%D1%83%D0%B0%D1%82%D0%B0%D1%86%D0%B8%D1%8F">Вики определяет эксплуатацию</a> как “использование чего-либо”. Как используются программы? Их устанавливают, конфигурируют, после чего убеждаются в корректности работы в соответствии с инструкцией.</p>

<p>Чтобы сделать программу эксплуатируемой необходимо предоставить документацию для всех этих процессов.</p>

<p>По правде говоря, проекты (а иногда даже продукты) редко сопровождаются хотя бы какой-то документацией, не говоря уже про документацию по эксплуатации. Подход “Это как-то работает”, “просто перезапусти”, вот это всё.</p>

<p>Поэтому я попытаюсь объяснить, как сделать веб-сервисы эксплуатируемыми. Есть <a href="https://12factor.net/">один достаточно известный ресурс</a> по этой теме, который более обширный и формальный, чем моя статья.</p>

<h2 id="стандартизируй">Стандартизируй!</h2>

<p>Под этим я имею ввиду две вещи.</p>

<h3 id="сделай-стандарт-документации-по-эксплуатации">Сделай стандарт документации по эксплуатации</h3>
<p>Во-первых, спроси своих коллег из отдела эксплуатации (админов). Особенно если уже есть какие-то сервисы в эксплуатации. Что они используют? Какой информации им не хватает?</p>

<p>Во-вторых, изучи свои проекты (и уже в эксплуатации и в ранней разработке). Подумай обо всех местах, которые могут быть сконфигурированы, о ситуациях, которые могут случиться. Думаешь, твою систему так легко понять? Я разочарую: совсем нет.</p>

<p>После сбора общей информации нужно написать шаблон документации по эксплуатации и всем его показать, обсудить, затем улучшить.</p>

<p>При этом нельзя относиться к получившемуся шаблону как к чему-то неизменному. После всех инцедентов (особенно пост-мортемов) необходимо подумать, не нужно ли добавить (или убрать) что-то в шаблон, чтобы, обладая документацией, команда эксплуатации смогла сама восстановить работу сервиса.</p>

<h3 id="сделай-процесс-документирования-обязательным-для-всех-разработчиков">Сделай процесс документирования обязательным для всех разработчиков</h3>
<p>С этим немного сложнее. Если ты — тимлид или старший разработчик, то используй свою власть чтобы сделать документирование эксплуатации обязательным. Если ты рядовой сотрудник — используй техники убеждения <del>социальную инженерию</del>, меритократические наклонности, своего начальника, свою репутацию, веди себя как полная скотина, но заставь всех писать документацию по эксплуатации. Просто поверь мне, это спасёт тебя лично от бессонных ночей (особенно если ты — тимлид или менеджер).</p>

<h2 id="сделай-свою-систему-эксплуатируемой">Сделай свою систему эксплуатируемой</h2>
<p>Это тоже непросто. Всё вот это добро из <a href="https://12factor.net/">12-factor</a> — это сюда.</p>

<h3 id="env-конфиги-проекта">ENV-конфиги проекта</h3>
<p>Это то, что я видел очень много раз. И каждый раз я старался от этого избавиться. Если в папке <code class="highlighter-rouge">config</code> есть что-то кроме <code class="highlighter-rouge">production</code>- и <code class="highlighter-rouge">test</code>-конфигов — всё плохо.</p>

<p>Просто представь: в час ночи сервер БД падает без шансов на восстановление, но у админов есть реплика, на которую можно переключиться очень быстро (в пределах <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D0%B3%D0%BB%D0%B0%D1%88%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BE%D0%B1_%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5_%D1%83%D1%81%D0%BB%D1%83%D0%B3">SLA</a>) просто поменяв IP-адрес (или доменное имя) БД в приложении. Но с хардкодом в <code class="highlighter-rouge">production</code>-конфиге это делается только через изменение кода и редеплой приложения. И вот она, бессонная ночь. И не одна.</p>

<p>Поэтому, чтобы сделать систему конфигурироемой “находу”, нужен либо config-provider, либо просто получение значений из ENV-переменных (со значениями по-умолчанию). Это уже добавит достаточно много сна в беспокойную жизнь разработчика.</p>

<p>И конечно, конфигурацию (ENV-переменные или config-provider’ы) очень даже стоит документировать. Поверь мне.</p>

<h3 id="добавь-проверки-запущенности-readiness-и-работоспособности-liveness">Добавь проверки запущенности (<em>readiness</em>) и работоспособности (<em>liveness</em>)</h3>
<p>Или, как некоторые их называют, хелсчеки. Я не про <a href="https://twitter.com/memenetes">кубернетисы</a>.</p>

<p>Зачем? Админам желательно знать, когда приложение уже запустилось (<em>readiness</em>) и когда оно упало (<em>liveness</em>).
Обычно веб-приложениям хватает ответа <code class="highlighter-rouge">200 OK</code> на запрос <code class="highlighter-rouge">/</code> для обеих проверок.</p>

<p>И затем опиши это всё в документации.</p>

<h3 id="сделай-кастомный-endpoint-для-мониторинга">Сделай кастомный endpoint для мониторинга</h3>
<p>Фишка в том, что скорее всего у админов уже есть какой-то инструмент мониторинга. Нет ничего плохого в том, чтобы помочь им.</p>

<p>Есть подозрения, что какая-то ошибка может проявиться? Отправляй их в мониторинг. Есть внешние системы? Проверяй к ним доступ.</p>

<p>Мы (на тех проектах, которые я разрабатывал) использовали <code class="highlighter-rouge">/healthcheck</code> с примерно следующим содержимым:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>db ok
smtp ok
rabbitmq ok
</code></pre></div></div>

<p>И опиши это в <strong>документации по эксплуатации</strong>.</p>

<h3 id="опиши-все-сервисы">Опиши все сервисы</h3>
<p>Используешь СУБД? Веб-сервер? Отправляешь email’ы? Опиши!</p>

<p>Для каждого описываемого сервиса нужно описать:</p>
<ol>
  <li>Откуда брать. Сборка кода? Docker? RPM-пакеты?</li>
  <li>Как запустить: команды, аргументы, флаги, вот это всё.</li>
  <li>Что сделать при первом старте. Например, импортировать какие-то данные “по-умолчанию” (возможно специальной командой).</li>
  <li>Зависимости. Не думаю, что есть смысл запускать сервер приложения до запуска СУБД.</li>
  <li>Масштабируемость. Веб-сервер достаточно легко (авто)масштабируется. А вот с масштабированием СУБД обычно всё не так хорошо.</li>
  <li>Требуемые ресурсы для работы. Память, процессор, диски, сокеты, inode’ы.</li>
  <li>Бэкапы. Что, как и когда нужно бэкапить и как это нужно восстанавливать.</li>
  <li>Зачем нужен этот сервис. Что именно он делает. Это поможет понять, можно ли перезапустить этот отдельный сервис или всё куда сложнее.</li>
</ol>

<p>При этом нужно помнить, что то, что ты обычно называешь “приложением” на самом деле тоже является сервисом. <a href="https://puma.io/">Puma</a> с <a href="https://rubyonrails.org/">рельсами</a> на борту — <strong>HTTP-сервер</strong>. <a href="https://github.com/ninenines/cowboy">Cowboy</a> с <a href="https://www.phoenixframework.org/">фениксом</a> на борту — тоже <strong>HTTP-сервер</strong>. <del>Java со спрингом — <em>это очень плохая идея нужно от такого избавляться год назад</em></del>.</p>

<h3 id="опиши-сеть">Опиши сеть</h3>
<p>Какие сервисы должны смотреть в мир? Какие сервисы должны смотреть друг в друга? Всё это — очень важная информация о том говнокоде, над которым ты сидел месяцами (или даже годами).</p>

<h3 id="ручки">Ручки</h3>
<p>Есть скрипт полной очистки? Кнопка пересборки кеша?<br />
Нет — сделай.<br />
И опиши.</p>

<h2 id="вместо-заключения">Вместо заключения</h2>
<p>Этим, на самом деле, список не ограничивается. Не надо “просто писать код”. Нужно делать эксплуатируемые сервисы.</p>

  </div>

  

  
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

  
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">ivalentinee</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">ivalentinee</li><li><a class="u-email" href="mailto:valentine.emperor@gmail.com">valentine.emperor@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ivalentinee"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ivalentinee</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p></p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
